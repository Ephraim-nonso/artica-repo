"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ae=require("@stablelib/chacha20poly1305"),dn=require("@stablelib/hkdf"),ce=require("@stablelib/random"),z=require("@stablelib/sha256"),ln=require("@stablelib/x25519"),d=require("uint8arrays"),pn=require("detect-browser"),C=require("@walletconnect/time"),w=require("@walletconnect/window-getters"),fn=require("@walletconnect/window-metadata"),mn=require("query-string"),yn=require("@walletconnect/relay-api");function ue(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}}),n.default=e,Object.freeze(n)}var de=ue(ln),M=ue(mn);const K=":";function le(e){const[n,t]=e.split(K);return{namespace:n,reference:t}}function pe(e){const{namespace:n,reference:t}=e;return[n,t].join(K)}function Y(e){const[n,t,r]=e.split(K);return{namespace:n,reference:t,address:r}}function fe(e){const{namespace:n,reference:t,address:r}=e;return[n,t,r].join(K)}function W(e,n){const t=[];return e.forEach(r=>{const s=n(r);t.includes(s)||t.push(s)}),t}function me(e){const{address:n}=Y(e);return n}function ye(e){const{namespace:n,reference:t}=Y(e);return pe({namespace:n,reference:t})}function gn(e,n){const{namespace:t,reference:r}=le(n);return fe({namespace:t,reference:r,address:e})}function hn(e){return W(e,me)}function ge(e){return W(e,ye)}function En(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const s=e[r];t.push(...s.accounts)}),t}function vn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const s=e[r];t.push(...ge(s.accounts))}),t}function Nn(e,n=[]){const t=[];return Object.keys(e).forEach(r=>{if(n.length&&!n.includes(r))return;const s=e[r];t.push(...k(r,s))}),t}function k(e,n){return e.includes(":")?[e]:n.chains||[]}const L=e=>e?.split(":"),he=e=>{const n=e&&L(e);if(n)return n[3]},bn=e=>{const n=e&&L(e);if(n)return n[2]+":"+n[3]},Ee=e=>{const n=e&&L(e);if(n)return n.pop()},On=(e,n)=>{const t=`${e.domain} wants you to sign in with your Ethereum account:`,r=Ee(n),s=e.statement,o=`URI: ${e.aud}`,i=`Version: ${e.version}`,l=`Chain ID: ${he(n)}`,p=`Nonce: ${e.nonce}`,a=`Issued At: ${e.iat}`,u=e.resources&&e.resources.length>0?`Resources:
${e.resources.map(c=>`- ${c}`).join(`
`)}`:void 0;return[t,r,"",s,"",o,i,l,p,a,u].filter(c=>c!=null).join(`
`)},G="base10",m="base16",q="base64pad",F="utf8",J=0,_=1,Sn=0,ve=1,Q=12,Z=32;function An(){const e=de.generateKeyPair();return{privateKey:d.toString(e.secretKey,m),publicKey:d.toString(e.publicKey,m)}}function Pn(){const e=ce.randomBytes(Z);return d.toString(e,m)}function Tn(e,n){const t=de.sharedKey(d.fromString(e,m),d.fromString(n,m)),r=new dn.HKDF(z.SHA256,t).expand(Z);return d.toString(r,m)}function In(e){const n=z.hash(d.fromString(e,m));return d.toString(n,m)}function Rn(e){const n=z.hash(d.fromString(e,F));return d.toString(n,m)}function Ne(e){return d.fromString(`${e}`,G)}function j(e){return Number(d.toString(e,G))}function Cn(e){const n=Ne(typeof e.type<"u"?e.type:J);if(j(n)===_&&typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof e.senderPublicKey<"u"?d.fromString(e.senderPublicKey,m):void 0,r=typeof e.iv<"u"?d.fromString(e.iv,m):ce.randomBytes(Q),s=new ae.ChaCha20Poly1305(d.fromString(e.symKey,m)).seal(r,d.fromString(e.message,F));return be({type:n,sealed:s,iv:r,senderPublicKey:t})}function _n(e){const n=new ae.ChaCha20Poly1305(d.fromString(e.symKey,m)),{sealed:t,iv:r}=X(e.encoded),s=n.open(r,t);if(s===null)throw new Error("Failed to decrypt");return d.toString(s,F)}function be(e){if(j(e.type)===_){if(typeof e.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return d.toString(d.concat([e.type,e.senderPublicKey,e.iv,e.sealed]),q)}return d.toString(d.concat([e.type,e.iv,e.sealed]),q)}function X(e){const n=d.fromString(e,q),t=n.slice(Sn,ve),r=ve;if(j(t)===_){const l=r+Z,p=l+Q,a=n.