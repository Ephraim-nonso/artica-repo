"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var M=require("events"),p=require("@walletconnect/utils"),P=require("@walletconnect/universal-provider");function A(n){if(n&&n.__esModule)return n;var t=Object.create(null);return n&&Object.keys(n).forEach(function(e){if(e!=="default"){var s=Object.getOwnPropertyDescriptor(n,e);Object.defineProperty(t,e,s.get?s:{enumerable:!0,get:function(){return n[e]}})}}),t.default=n,Object.freeze(t)}const T="wc",R="ethereum_provider",S=`${T}@2:${R}:`,j="https://rpc.walletconnect.com/v1/",m=["eth_sendTransaction","personal_sign"],w=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],g=["chainChanged","accountsChanged"],_=["message","disconnect","connect"];var N=Object.defineProperty,q=Object.defineProperties,D=Object.getOwnPropertyDescriptors,O=Object.getOwnPropertySymbols,$=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable,y=(n,t,e)=>t in n?N(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e,u=(n,t)=>{for(var e in t||(t={}))$.call(t,e)&&y(n,e,t[e]);if(O)for(var e of O(t))U.call(t,e)&&y(n,e,t[e]);return n},b=(n,t)=>q(n,D(t));function v(n){return Number(n[0].split(":")[1])}function f(n){return`0x${n.toString(16)}`}function Q(n){const{chains:t,optionalChains:e,methods:s,optionalMethods:i,events:a,optionalEvents:c,rpcMap:h}=n;if(!p.isValidArray(t))throw new Error("Invalid chains");const o={chains:t,methods:s||m,events:a||g,rpcMap:u({},t.length?{[v(t)]:h[v(t)]}:{})},r=a?.filter(l=>!g.includes(l)),d=s?.filter(l=>!m.includes(l));if(!e&&!c&&!i&&!(r!=null&&r.length)&&!(d!=null&&d.length))return{required:t.length?o:void 0};const C=r?.length&&d?.length||!e,E={chains:[...new Set(C?o.chains.concat(e||[]):e)],methods:[...new Set(o.methods.concat(i!=null&&i.length?i:w))],events:[...new Set(o.events.concat(c||_))],rpcMap:h};return{required:t.length?o:void 0,optional:e.length?E:void 0}}class I{constructor(){this.events=new M.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=S,this.on=(t,e)=>(this.events.on(t,e),this),this.once=(t,e)=>(this.events.once(t,e),this),this.removeListener=(t,e)=>(this.events.removeListener(t,e),this),this.off=(t,e)=>(this.events.off(t,e),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const e=new I;return await e.initialize(t),e}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,e){this.signer.sendAsync(t,e,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:e,optional:s}=Q(this.rpc);try{const i=await new Promise(async(c,h)=>{var o;this.rpc.showQrModal&&((o=this.modal)==null||o.subscribeModal(r=>{!r.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),h(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(b(u({namespaces:u({},e&&{[this.namespace]:e})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t?.pairingTopic})).then(r=>{c(r)}).catch(r=>{h(new Error(r.message))})});if(!i)return;this.setChainIds(this.rpc.chains);const a=p.getAccountsFromNamespaces(i.namespaces,[this.namespace]);this.setAccounts(a),this.events.emit("connect",{chainId:f(this.chainId)})}catch(i){throw this.signer.logger.error(i),i}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()